<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>เปลี่ยนรหัสผ่าน</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html {
    margin: 0;
    padding: 0;
    height: auto;   /* เต็ม viewport จริงบนมือถือ */
    width: auto;
    overflow-x: hidden;
    }
    body {
      margin: 0;
      padding: 0;
      height: 100dvh; /* เต็มความสูง viewport จริง */
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-y: auto; /* ให้ pull-to-refresh ทำงาน */
      overflow-x: hidden;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top left, #0f172a, #020617 70%);
      color: #e0e0e0;
      -webkit-overflow-scrolling: touch;
    }
    .glass {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .neon-border {
      border: 1px solid transparent;
      background-clip: padding-box;
      box-shadow: 0 0 12px rgba(59,130,246,0.6),
                  0 0 24px rgba(168,85,247,0.5);
    }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.6;} }

    .group {
      position: relative;
      flex: 1;
    }
    .group input {
      width: 100%;
      padding: 16px 10px 8px 5px;
      border: none;
      border-bottom: 1px solid #666;
      background: transparent;
      color: #e0e0e0;
      outline: none;
      display: block;
    }
    .group label {
      position: absolute;
      left: 5px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
      font-size: 16px;
      pointer-events: none;
      transition: transform 0.2s ease, color 0.2s ease;
      transform-origin: left top;
    }
    .group input:focus ~ label,
    .group input:not(:placeholder-shown) ~ label {
      transform: translateY(-150%) scale(0.875);
      color: #a855f7;
    }
    input[type="password"]:focus {
      border-width: 2px;
      border-bottom-color: #a855f7;
    }
  </style>
</head>
<body class="flex items-center justify-center h-screen px-4 sm:px-6 lg:px-8">

<div class="w-full max-w-sm sm:max-w-md glass neon-border rounded-2xl shadow-xl p-6 sm:p-8 relative">
  <div class="absolute -top-6 -right-6 w-20 h-20 sm:w-24 sm:h-24 bg-purple-600/30 rounded-full blur-3xl pulse"></div>

    <h2 class="text-3xl font-extrabold text-center bg-gradient-to-r from-cyan-400 via-purple-400 to-blue-500 bg-clip-text text-transparent drop-shadow-lg pulse mb-6">
      Change Password
    </h2>

    {% if error %}
    <div class="mb-4 p-3 text-red-400 bg-red-900/30 rounded">{{ error }}</div>
    {% endif %}

    <form method="post" class="space-y-5">

      <!-- รหัสผ่านเก่า -->
      <div class="relative">
        <div class="group flex-1 relative">
          <input type="password" name="old_password" id="old_password" placeholder=" " required />
          <label for="old_password">Old password</label>
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-300"
                  onclick="togglePassword('old_password', this)">
            <!-- Eye SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7S3.732 16.057 2.458 12z" />
            </svg>
          </button>
        </div>
      </div>

      <!-- รหัสผ่านใหม่ -->
      <div class="relative">
        <div class="group flex-1 relative">
          <input type="password" name="new_password" id="new_password" placeholder=" " required />
          <label for="new_password">New password</label>
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-300"
                  onclick="togglePassword('new_password', this)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7S3.732 16.057 2.458 12z" />
            </svg>
          </button>
        </div>
        <div id="new-password-error-format" class="text-sm text-red-400 hidden mt-1 ml-1"></div>
      </div>

      <!-- ยืนยันรหัสผ่านใหม่ -->
      <div class="relative">
        <div class="group flex-1 relative">
          <input type="password" name="confirm_new_password" id="confirm_new_password" placeholder=" " required />
          <label for="confirm_new_password">Confirm new password</label>
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-300"
                  onclick="togglePassword('confirm_new_password', this)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7S3.732 16.057 2.458 12z" />
            </svg>
          </button>
        </div>
        <div id="confirm-password-error" class="text-sm text-red-400 hidden mt-1 ml-1"></div>
      </div>

      <button type="submit" class="w-full py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg font-semibold shadow-lg hover:opacity-80 transition">
        เปลี่ยนรหัสผ่าน
      </button>

    </form>
  </div>

  <script>
    const newPasswordInput = document.getElementById("new_password");
    const confirmNewPasswordInput = document.getElementById("confirm_new_password");
    const newPasswordErrorFormat = document.getElementById("new-password-error-format");
    const confirmPasswordError = document.getElementById("confirm-password-error");

    function showError(inputElem, errorDiv, message) {
      if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.classList.remove("hidden");
      }
      inputElem.classList.add("border-b-2", "border-red-500");
    }
    function hideError(inputElem, errorDiv) {
      if (errorDiv) {
        errorDiv.classList.add("hidden");
      }
      inputElem.classList.remove("border-b-2", "border-red-500");
    }

    function validatePasswordComplexity(pwd) {
      if (!pwd) return "กรุณากรอกรหัสผ่าน";

      const invalidCheck = /[^a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd);
      if (invalidCheck) return "ห้ามมีตัวอักษรนอกเหนือที่กำหนด";

      const lengthCheck = pwd.length >= 8;
      const lowerCheck = /[a-z]/.test(pwd);
      const upperCheck = /[A-Z]/.test(pwd);
      const numberCheck = /[0-9]/.test(pwd);
      const specialCheck = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd);

      if (!lengthCheck) return "รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร";
      if (!lowerCheck) return "ต้องมีอักษรพิมพ์เล็กอย่างน้อย 1 ตัว";
      if (!upperCheck) return "ต้องมีอักษรพิมพ์ใหญ่อย่างน้อย 1 ตัว";
      if (!numberCheck) return "ต้องมีตัวเลขอย่างน้อย 1 ตัว";
      if (!specialCheck) return "ต้องมีอักขระพิเศษอย่างน้อย 1 ตัว";

      return "";
    }

    function checkPasswordMatch() {
      const pwd = newPasswordInput.value;
      const confirm = confirmNewPasswordInput.value;

      hideError(newPasswordInput, newPasswordErrorFormat);
      hideError(confirmNewPasswordInput, confirmPasswordError);

      const pwdMsg = validatePasswordComplexity(pwd);
      if (pwdMsg) {
        showError(newPasswordInput, newPasswordErrorFormat, pwdMsg);
      }

      if (!confirm) {
        showError(confirmNewPasswordInput, confirmPasswordError, "กรุณายืนยันรหัสผ่าน");
      } else if (pwd !== confirm) {
        showError(confirmNewPasswordInput, confirmPasswordError, "รหัสผ่านไม่ตรงกัน");
      }
    }

    // bind events
    newPasswordInput.addEventListener("blur", () => {
      const pwdMsg = validatePasswordComplexity(newPasswordInput.value);
      if (pwdMsg) {
        showError(newPasswordInput, newPasswordErrorFormat, pwdMsg);
      } else {
        hideError(newPasswordInput, newPasswordErrorFormat);
      }
      checkPasswordMatch();
    });

    confirmNewPasswordInput.addEventListener("blur", checkPasswordMatch);

    lucide.createIcons();

    function togglePassword(id, btn) {
      const input = document.getElementById(id);
      const isPassword = input.type === "password";
      input.type = isPassword ? "text" : "password";

      btn.innerHTML = isPassword
        ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a10.06 10.06 0 012.648-4.155M9.88 9.88A3 3 0 0114.12 14.12M4.22 4.22l15.56 15.56" />
          </svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7S3.732 16.057 2.458 12z" />
          </svg>`;
    }
  </script>

</body>
</html>
